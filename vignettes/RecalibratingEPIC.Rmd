---
title: "RecalibratingEPIC"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{RecalibratingEPIC}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(epicR)
```

Assessing calibration of exacerbations with current EPIC's equations:

```{r validation}
inputs <- get_input()$values
validate_exacerbation(5e4, inputs)
```

The current input equation for exacerbations include a term for diagnosis: `r input$exacerbation$ln_rate_betas `

As a result, whether a person is diagnosed or not will affect the exacerbation rates, which does not have causal face validity, and is particularly undesirable for case detection studies that assess diagnosis. 

If we remove the diagnosis term, the calibration will look like this:

```{r validationNewEquation}
inputs$exacerbation$ln_rate_betas <- t(as.matrix(c(intercept = 1.7, female = 0, age = 0.04082 * 0.1, fev1 = -1.5, smoking_status = 0, gold1 = 0.6 , gold2 = 0.35 , gold3 = 0.08 , gold4 = -0.35 , diagnosis_effect = 0)))
validate_exacerbation(5e4, inputs)
```

